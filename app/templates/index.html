<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Sales Prediction - AI Model Comparison</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="logo">üìä Loan Sales Prediction</h1>
                <div class="header-stats">
                    <div class="stat-item">
                        <span class="stat-label">Total Models</span>
                        <span class="stat-value" id="total-models">18</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Best R¬≤</span>
                        <span class="stat-value" id="best-r2">0.4274</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Hero Section -->
            <section class="hero">
                <h2 class="hero-title">AI-Powered Loan Sales Forecasting</h2>
                <p class="hero-subtitle">Compare 18 different ML and Time Series models for accurate predictions</p>
            </section>

            <!-- Prediction Form -->
            <section class="prediction-section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üéØ Make Prediction</h3>
                    </div>
                    <div class="card-body">
                        <form id="prediction-form">
                            <div class="form-grid">
                                <!-- Year Selection -->
                                <div class="form-group">
                                    <label for="year">Year</label>
                                    <select id="year" name="year" class="form-control" required>
                                        <option value="2020">2020</option>
                                        <option value="2021">2021</option>
                                        <option value="2022">2022</option>
                                        <option value="2023">2023</option>
                                        <option value="2024">2024</option>
                                        <option value="2025" selected>2025</option>
                                        <option value="2026">2026</option>
                                        <option value="2027">2027</option>
                                        <option value="2028">2028</option>
                                        <option value="2029">2029</option>
                                        <option value="2030">2030</option>
                                    </select>
                                </div>

                                <!-- Quarter Selection -->
                                <div class="form-group">
                                    <label for="quarter">Quarter</label>
                                    <select id="quarter" name="quarter" class="form-control" required>
                                        <option value="1">Q1</option>
                                        <option value="2">Q2</option>
                                        <option value="3">Q3</option>
                                        <option value="4" selected>Q4</option>
                                    </select>
                                </div>

                                <!-- Model Selection -->
                                <div class="form-group form-group-full">
                                    <label for="model">Model</label>
                                    <select id="model" name="model" class="form-control" required>
                                        <option value="">Loading models...</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <span class="btn-icon">üîÆ</span>
                                    Predict
                                </button>
                                <button type="button" id="compare-btn" class="btn btn-secondary">
                                    <span class="btn-icon">üìä</span>
                                    Compare Models
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section" id="results-section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìà Prediction Results</h3>
                        <div class="card-actions">
                            <button class="btn btn-secondary btn-sm" onclick="exportToPDF()" style="display: none;" id="export-pdf-btn">
                                <span class="btn-icon">üìÑ</span>
                                Export PDF
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="exportToExcel()" style="display: none;" id="export-excel-btn">
                                <span class="btn-icon">üìä</span>
                                Export Excel
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Single Prediction Result -->
                        <div id="single-result" style="display: none;">
                            <div class="result-hero">
                                <div class="result-label">Predicted Loan Sales</div>
                                <div class="result-value" id="prediction-value">0 AZN</div>
                                <div class="result-meta">
                                    <span id="prediction-period">2025 Q4</span>
                                    <span class="separator">‚Ä¢</span>
                                    <span id="prediction-model">Model Name</span>
                                </div>
                            </div>

                            <div class="metrics-grid">
                                <div class="metric-card">
                                    <div class="metric-label">R¬≤ Score</div>
                                    <div class="metric-value" id="metric-r2">0.0000</div>
                                    <div class="metric-desc">Variance Explained</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">RMSE</div>
                                    <div class="metric-value" id="metric-rmse">0</div>
                                    <div class="metric-desc">Root Mean Square Error</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">MAE</div>
                                    <div class="metric-value" id="metric-mae">0</div>
                                    <div class="metric-desc">Mean Absolute Error</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">MAPE</div>
                                    <div class="metric-value" id="metric-mape">0.00%</div>
                                    <div class="metric-desc">Mean Absolute % Error</div>
                                </div>
                            </div>
                        </div>

                        <!-- Comparison Results -->
                        <div id="comparison-results" style="display: none;">
                            <div class="comparison-header">
                                <h4>Model Comparison</h4>
                                <p id="comparison-period">Comparing predictions for 2025 Q4</p>
                            </div>
                            <div class="table-responsive">
                                <table class="comparison-table">
                                    <thead>
                                        <tr>
                                            <th>Rank</th>
                                            <th>Model</th>
                                            <th>Type</th>
                                            <th>Prediction</th>
                                            <th>R¬≤ Score</th>
                                            <th>MAPE</th>
                                        </tr>
                                    </thead>
                                    <tbody id="comparison-table-body">
                                        <!-- Populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Loading State -->
                        <div id="loading-state" style="display: none;">
                            <div class="loading-spinner"></div>
                            <p class="loading-text">Processing prediction...</p>
                        </div>

                        <!-- Error State -->
                        <div id="error-state" style="display: none;">
                            <div class="error-message">
                                <span class="error-icon">‚ö†Ô∏è</span>
                                <span id="error-text">An error occurred</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Model Info Section -->
            <section class="models-info-section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ü§ñ Available Models</h3>
                    </div>
                    <div class="card-body">
                        <div class="models-grid" id="models-grid">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Loan Sales Prediction. Powered by 18 AI Models.</p>
            <p class="footer-links">
                <a href="/api/health">API Health</a>
                <span class="separator">‚Ä¢</span>
                <a href="/api/models">API Docs</a>
            </p>
        </div>
    </footer>

    <!-- Comparison Modal -->
    <div id="comparison-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Select Models to Compare</h3>
                <button class="modal-close" onclick="closeComparisonModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-subtitle">Select 2-5 models to compare (best performers are pre-selected)</p>
                <div id="model-checkboxes" class="checkbox-grid">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeComparisonModal()">Cancel</button>
                <button class="btn btn-primary" onclick="runComparison()">Compare Selected Models</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', path='/js/main.js') }}"></script>
</body>
</html>
